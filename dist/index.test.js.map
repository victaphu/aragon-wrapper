{"version":3,"sources":["../src/index.test.js"],"names":["encodeCallScript","callscriptUtils","APP_NAMESPACE_HASH","CORE_NAMESPACE_HASH","test","beforeEach","t","apmCoreStub","getApmInternalAppInfo","sinon","stub","aragonOSCoreStub","getAragonOsInternalAppInfo","configurationStub","setConfiguration","ensStub","resolve","messengerConstructorStub","signals","rpcSignals","utilsStub","AsyncRequestCache","getCacheKey","addressesEqual","Object","is","callscript","forwarding","forwardingUtils","makeAddressMapProxy","fake","returns","makeProxy","transactions","transactionsUtils","Aragon","proxyquire","noCallThru","load","apps","assign","apm","configurationKeys","default","createAragon","daoAddress","options","ensRegistryAddress","context","afterEach","always","restore","plan","app","not","undefined","badDaoAddress","instance","kernelProxyCallStub","withArgs","throws","kernelProxy","address","call","throwsAsync","init","instanceOf","Error","message","truthy","calledTwice","calledWith","FORCE_LOCAL_STORAGE","SUBSCRIPTION_EVENT_DELAY","cache","forceLocalStorage","events","subscriptionEventDelay","initAccounts","providedAccounts","accounts","getAccounts","deepEqual","web3","eth","resolves","fetchFromWeb3","testNetworkId","testNetworkType","getChainId","net","getNetworkType","initNetwork","network","subscribe","id","type","instance1","instance2","initGuiStyle","setGuiStyle","name","guiStyle","value","appearance","theme","aclEvents","event","returnValues","role","allowed","entity","manager","get","set","aclProxyStub","pastEvents","initAcl","Promise","permissions","counter","add","allowedEntities","subtract","defaultAclAddress","kernelProxyStub","calledOnceWith","givenAclAddress","aclAddress","notCalled","neverCalledWith","kernelAddress","appInitTestCases","forEach","testName","permissionsObj","appIds","codeAddresses","keys","proxyStub","abi","isAragonOsInternalApp","returnsArg","fetchLatestRepoContentForContract","appId","initApps","pipe","codeAddress","proxyAddress","isForwarder","setAppEventStub","Subject","next","namespace","setTimeout","updated","initAppIdentifiers","appIdentifiers","setAppIdentifier","initIdentityProviders","identityProviderRegistrar","true","Map","size","expectedAddress","identityIntents","intent","providerName","requestAddressIdentityModification","all","then","val","reject","initForwarders","forwarders","messageToSign","requestingApp","signatures","signMessage","key","initialAddress","targetAddress","transaction","to","Array","isArray","path","length","performTransactionPath","functions","sig","roles","calculateTransactionPath","catch","err","targetMethodAbiFragment","targetParams","mockPath","data","aclProxy","getTransactionPath","externalPath","getExternalTransactionPath","mockTransaction","describeTransactionPath","createDirectTransaction","getACLTransactionPath","requestsStub","method","params","messengerStub","sendResponse","requests","makeProxyFromAppABI","updateInitializationBlock","initializationBlock","connect","runApp","result","shutdown","shutdownAndClearCache","getCall","args","ReplaySubject","callCount","runningProxyAddress","getAll","every","startsWith","getApp","getPermissionManager","script","decodedScript","decodeTransactionPath","children","nestedScript","substring","nestedScriptDataLength","toString","padStart","badSpecId"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport proxyquire from 'proxyquire'\nimport { empty, from, of, ReplaySubject, Subject } from 'rxjs'\nimport { first } from 'rxjs/operators'\nimport { signals as rpcSignals } from '@aragon/rpc-messenger'\n\nimport * as apps from './apps'\nimport * as configurationKeys from './configuration/keys'\nimport * as apm from './core/apm'\nimport { getCacheKey } from './utils'\nimport AsyncRequestCache from './utils/AsyncRequestCache'\nimport * as callscriptUtils from './utils/callscript'\nimport * as forwardingUtils from './utils/forwarding'\nimport * as transactionsUtils from './utils/transactions'\n\nconst { encodeCallScript } = callscriptUtils\n\n// soliditySha3('app')\nconst APP_NAMESPACE_HASH = '0xf1f3eb40f5bc1ad1344716ced8b8a0431d840b5783aea1fd01786bc26f35ac0f'\n// soliditySha3('core')\nconst CORE_NAMESPACE_HASH = '0xc681a85306374a5ab27f0bbc385296a54bcd314a1948b6cf61c4ea1bc44bb9f8'\n\ntest.beforeEach(t => {\n  const apmCoreStub = {\n    getApmInternalAppInfo: sinon.stub()\n  }\n  const aragonOSCoreStub = {\n    getAragonOsInternalAppInfo: sinon.stub()\n  }\n  const configurationStub = {\n    setConfiguration: sinon.stub()\n  }\n  const ensStub = {\n    resolve: sinon.stub()\n  }\n  const messengerConstructorStub = sinon.stub()\n  messengerConstructorStub.signals = rpcSignals\n  const utilsStub = {\n    AsyncRequestCache,\n    getCacheKey,\n    addressesEqual: Object.is,\n    callscript: callscriptUtils,\n    forwarding: forwardingUtils,\n    makeAddressMapProxy: sinon.fake.returns({}),\n    makeProxy: sinon.stub(),\n    transactions: transactionsUtils\n  }\n  const Aragon = proxyquire.noCallThru().load('./index', {\n    '@aragon/rpc-messenger': messengerConstructorStub,\n    './apps': apps,\n    './core/aragonOS': aragonOSCoreStub,\n    './core/apm': Object.assign(apm, apmCoreStub),\n    './configuration': configurationStub,\n    './configuration/keys': configurationKeys,\n    './ens': () => ensStub,\n    './utils': utilsStub\n  }).default\n\n  // Helper for creating Aragon class instances\n  function createAragon (daoAddress = '0x00', options) {\n    return new Aragon(daoAddress, {\n      apm: {\n        ensRegistryAddress: '0x00'\n      },\n      ...options\n    })\n  }\n\n  t.context = {\n    Aragon,\n    apmCoreStub,\n    aragonOSCoreStub,\n    createAragon,\n    configurationStub,\n    ensStub,\n    messengerConstructorStub,\n    utilsStub\n  }\n})\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should create an Aragon instance with no options given', t => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // act\n  const app = createAragon()\n  // assert\n  t.not(app.apm, undefined)\n})\n\ntest('should throw on init if daoAddress is not a Kernel', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const badDaoAddress = '0xbaddao'\n  const instance = createAragon(badDaoAddress)\n  // web3 will throw if a bad address ('0x') comes back\n  const kernelProxyCallStub = sinon.stub().withArgs('acl').throws()\n  instance.kernelProxy = {\n    address: badDaoAddress,\n    call: kernelProxyCallStub\n  }\n\n  // act and assert\n  await t.throwsAsync(\n    instance.init(),\n    {\n      instanceOf: Error,\n      message: `Provided daoAddress is not a DAO`\n    }\n  )\n})\n\ntest('should set the default configuration', t => {\n  const { createAragon, configurationStub } = t.context\n\n  t.plan(4)\n  // act\n  const instance = createAragon()\n  // assert\n  t.truthy(configurationStub.setConfiguration.calledTwice)\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.FORCE_LOCAL_STORAGE, false)\n  )\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.SUBSCRIPTION_EVENT_DELAY, 0)\n  )\n  t.not(instance.apm, undefined)\n})\n\ntest('should set the given configuration', t => {\n  const { createAragon, configurationStub } = t.context\n\n  t.plan(4)\n  // act\n  const instance = createAragon('0x00', {\n    cache: { forceLocalStorage: true },\n    events: { subscriptionEventDelay: 1000 }\n  })\n  // assert\n  t.truthy(configurationStub.setConfiguration.calledTwice)\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.FORCE_LOCAL_STORAGE, true)\n  )\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.SUBSCRIPTION_EVENT_DELAY, 1000)\n  )\n  t.not(instance.apm, undefined)\n})\n\ntest(\"should set the default configuration if overriding configuration doesn't contain keys\", t => {\n  const { createAragon, configurationStub } = t.context\n\n  t.plan(4)\n  // act\n  const instance = createAragon('0x00', {\n    cache: {},\n    events: {}\n  })\n  // assert\n  t.truthy(configurationStub.setConfiguration.calledTwice)\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.FORCE_LOCAL_STORAGE, false)\n  )\n  t.truthy(\n    configurationStub.setConfiguration.calledWith(configurationKeys.SUBSCRIPTION_EVENT_DELAY, 0)\n  )\n  t.not(instance.apm, undefined)\n})\n\ntest('should use provided accounts', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  // act\n  await instance.initAccounts({ providedAccounts: ['0x00'] })\n  const accounts = await instance.getAccounts()\n  // assert\n  t.deepEqual(accounts, ['0x00'])\n})\n\ntest('should get the accounts from web3', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.web3 = {\n    eth: {\n      getAccounts: sinon.stub().resolves(['0x01', '0x02'])\n    }\n  }\n  // act\n  await instance.initAccounts({ fetchFromWeb3: true })\n  const accounts = await instance.getAccounts()\n  // assert\n  t.deepEqual(accounts, ['0x01', '0x02'])\n})\n\ntest('should not fetch the accounts if not asked', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.web3 = {\n    eth: {\n      getAccounts: sinon.stub().resolves(['0x01', '0x02'])\n    }\n  }\n  // act\n  await instance.initAccounts({ fetchFromWeb3: false })\n  const accounts = await instance.getAccounts()\n  // assert\n  t.deepEqual(accounts, [])\n})\n\ntest('should get the network details from web3', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  const testNetworkId = 4\n  const testNetworkType = 'rinkeby'\n  instance.web3 = {\n    eth: {\n      getChainId: sinon.stub().resolves(testNetworkId),\n      net: {\n        getNetworkType: sinon.stub().resolves(testNetworkType)\n      }\n    }\n  }\n  // act\n  await instance.initNetwork()\n  // assert\n  instance.network.subscribe(network => {\n    t.deepEqual(network, {\n      id: testNetworkId,\n      type: testNetworkType\n    })\n  })\n})\n\ntest('should set the GUI style', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(2)\n\n  // arrange\n  const instance1 = createAragon()\n  const instance2 = createAragon()\n  instance1.initGuiStyle()\n  instance2.initGuiStyle()\n\n  // act\n  instance1.setGuiStyle('black', { name: 'Black theme' })\n  instance2.setGuiStyle('dark')\n\n  // assert\n  t.deepEqual(instance1.guiStyle.value, {\n    appearance: 'black',\n    theme: { name: 'Black theme' }\n  })\n  t.deepEqual(instance2.guiStyle.value, {\n    appearance: 'dark',\n    theme: null\n  })\n})\n\nconst aclEvents = from([{\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'add',\n    allowed: true,\n    entity: '0x1'\n  }\n}, {\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'subtract',\n    allowed: true,\n    entity: '0x1'\n  }\n}, {\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'add',\n    allowed: true,\n    entity: '0x2'\n  }\n}, {\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'subtract',\n    allowed: true,\n    entity: '0x2'\n  }\n}, {\n  // Simulate real world mixed order of event types\n  event: 'ChangePermissionManager',\n  returnValues: {\n    app: 'counter',\n    role: 'subtract',\n    manager: 'manager'\n  }\n}, {\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'subtract',\n    allowed: false,\n    entity: '0x2'\n  }\n}, {\n  // duplicate, should not affect the final result because we use a Set\n  event: 'SetPermission',\n  returnValues: {\n    app: 'counter',\n    role: 'subtract',\n    allowed: false,\n    entity: '0x2'\n  }\n}])\n\ntest('should init the ACL correctly', async (t) => {\n  const { createAragon, utilsStub } = t.context\n\n  t.plan(1)\n\n  const instance = createAragon()\n  instance.kernelProxy = {\n    call: sinon.stub()\n  }\n  instance.cache.get = sinon.stub().returns({})\n  instance.cache.set = sinon.stub().resolves()\n\n  const aclProxyStub = {\n    events: sinon.stub().returns(aclEvents),\n    pastEvents: sinon.stub().returns(empty())\n  }\n  utilsStub.makeProxy.returns(aclProxyStub)\n  // act\n  await instance.initAcl()\n  // assert, tell ava to wait for the permissions observable to debounce\n  return new Promise(resolve => {\n    instance.permissions.subscribe(value => {\n      t.deepEqual(value, {\n        counter: {\n          add: {\n            allowedEntities: ['0x1', '0x2']\n          },\n          subtract: {\n            allowedEntities: ['0x1'],\n            manager: 'manager'\n          }\n        }\n      })\n      // The permissions observable debounces, so we should only get one value back\n      resolve()\n    })\n  })\n})\n\ntest('should init the acl with the default acl fetched from the kernel by default', async (t) => {\n  const { createAragon, utilsStub } = t.context\n\n  t.plan(2)\n  // arrange\n  const defaultAclAddress = '0x321'\n  const aclProxyStub = {\n    events: sinon.stub().returns(aclEvents),\n    pastEvents: sinon.stub().returns(empty())\n  }\n\n  const kernelProxyStub = {\n    call: sinon.stub()\n      .withArgs('acl').resolves(defaultAclAddress)\n  }\n  utilsStub.makeProxy\n    .returns(kernelProxyStub)\n    .withArgs(defaultAclAddress).returns(aclProxyStub)\n\n  const instance = createAragon()\n  instance.cache.get = sinon.stub().returns({})\n  instance.cache.set = sinon.stub().resolves()\n\n  // act\n  await instance.initAcl()\n  // assert\n  t.truthy(kernelProxyStub.call.calledOnceWith('acl'))\n  t.truthy(utilsStub.makeProxy.calledWith(defaultAclAddress))\n})\n\ntest('should init the acl with the provided acl', async (t) => {\n  const { createAragon, utilsStub } = t.context\n\n  t.plan(3)\n  // arrange\n  const defaultAclAddress = '0x321'\n  const givenAclAddress = '0x123'\n  const aclProxyStub = {\n    events: sinon.stub().returns(aclEvents),\n    pastEvents: sinon.stub().returns(empty())\n  }\n  const kernelProxyStub = {\n    call: sinon.stub()\n      .withArgs('acl').resolves(defaultAclAddress)\n  }\n  utilsStub.makeProxy\n    .returns(kernelProxyStub)\n    .withArgs(givenAclAddress).returns(aclProxyStub)\n\n  const instance = createAragon()\n  instance.cache.get = sinon.stub().returns({})\n  instance.cache.set = sinon.stub().resolves()\n\n  // act\n  await instance.initAcl({ aclAddress: givenAclAddress })\n  // assert\n  t.truthy(kernelProxyStub.call.notCalled)\n  t.truthy(utilsStub.makeProxy.neverCalledWith(defaultAclAddress))\n  t.truthy(utilsStub.makeProxy.calledWith(givenAclAddress))\n})\n\nconst kernelAddress = '0x123'\nconst appInitTestCases = [\n  [\n    'with kernel in permissions',\n    {\n      [kernelAddress]: 'some permissions',\n      '0x456': 'some permissions',\n      '0x789': 'some permissions',\n      '0xrepo': 'some permissions'\n    }\n  ],\n  [\n    'without kernel in permissions',\n    {\n      '0x456': 'some permissions',\n      '0x789': 'some permissions',\n      '0xrepo': 'some permissions'\n    }\n  ]\n]\nappInitTestCases.forEach(([testName, permissionsObj]) => {\n  test(`should init the apps correctly - ${testName}`, async (t) => {\n    const { createAragon, aragonOSCoreStub, apmCoreStub, ensStub, utilsStub } = t.context\n\n    t.plan(1)\n    // arrange\n    const kernelAddress = '0x123'\n    const appIds = {\n      [kernelAddress]: 'kernel',\n      '0x456': 'counterApp',\n      '0x789': 'votingApp',\n      '0xrepo': 'repoApp'\n    }\n    const codeAddresses = {\n      [kernelAddress]: '0xkernel',\n      '0x456': '0xcounterApp',\n      '0x789': '0xvotingApp',\n      '0xrepo': '0xrepoApp'\n    }\n    // Stub makeProxy for each app\n    Object.keys(appIds).forEach(address => {\n      const proxyStub = {\n        call: sinon.stub()\n      }\n      proxyStub.call\n        .withArgs('kernel').resolves(kernelAddress)\n        .withArgs('appId').resolves(appIds[address])\n        .withArgs('implementation').resolves(codeAddresses[address])\n        .withArgs('isForwarder').resolves(false)\n\n      utilsStub.makeProxy\n        .withArgs(address).returns(proxyStub)\n    })\n    aragonOSCoreStub.getAragonOsInternalAppInfo.withArgs(appIds[kernelAddress]).returns({\n      abi: 'abi for kernel',\n      isAragonOsInternalApp: true\n    })\n    apmCoreStub.getApmInternalAppInfo.withArgs(appIds['0xrepo']).returns({\n      abi: 'abi for repo'\n    })\n    // Mock ens resolution to just return the appId\n    ensStub.resolve = sinon.stub().returnsArg(0)\n\n    const instance = createAragon()\n    instance.apm = {\n      fetchLatestRepoContentForContract: (appId) => Promise.resolve({\n        abi: `abi for ${appId}`\n      })\n    }\n    instance.permissions = of(permissionsObj)\n    instance.kernelProxy = {\n      address: kernelAddress,\n      call: sinon.stub().withArgs('KERNEL_APP_ID').resolves('kernel'),\n      events: sinon.stub().returns(empty())\n    }\n\n    // act\n    await instance.initApps()\n\n    // assert\n    // Check value of apps\n    return new Promise(resolve => {\n      instance.apps.pipe(first()).subscribe(value => {\n        t.deepEqual(value, [\n          {\n            abi: 'abi for kernel',\n            appId: 'kernel',\n            codeAddress: '0xkernel',\n            isAragonOsInternalApp: true,\n            proxyAddress: '0x123'\n          }, {\n            abi: 'abi for counterApp',\n            appId: 'counterApp',\n            codeAddress: '0xcounterApp',\n            isForwarder: false,\n            kernelAddress: '0x123',\n            proxyAddress: '0x456'\n          }, {\n            abi: 'abi for votingApp',\n            appId: 'votingApp',\n            codeAddress: '0xvotingApp',\n            isForwarder: false,\n            kernelAddress: '0x123',\n            proxyAddress: '0x789'\n          }, {\n            abi: 'abi for repoApp',\n            appId: 'repoApp',\n            codeAddress: '0xrepoApp',\n            isForwarder: false,\n            kernelAddress: '0x123',\n            proxyAddress: '0xrepo'\n          }\n        ])\n        resolve()\n      })\n    })\n  })\n})\n\ntest('should update the apps correctly on SetApp', async (t) => {\n  const { createAragon, aragonOSCoreStub, ensStub, utilsStub } = t.context\n  const setAppEventStub = new Subject()\n\n  t.plan(4)\n  // arrange\n  const kernelAddress = '0x123'\n  const permissionsObj = {\n    '0x456': 'some permissions',\n    '0x789': 'some permissions'\n  }\n  const appIds = {\n    [kernelAddress]: 'kernel',\n    '0x456': 'counterApp',\n    '0x789': 'votingApp'\n  }\n  const codeAddresses = {\n    [kernelAddress]: '0xkernel',\n    '0x456': '0xcounterApp',\n    '0x789': '0xvotingApp'\n  }\n  // Stub makeProxy for each app\n  Object.keys(appIds).forEach(address => {\n    const proxyStub = {\n      call: sinon.stub()\n    }\n    proxyStub.call\n      .withArgs('kernel').resolves(kernelAddress)\n      .withArgs('appId').resolves(appIds[address])\n      .withArgs('implementation').resolves(codeAddresses[address])\n      .withArgs('isForwarder').resolves(false)\n\n    utilsStub.makeProxy\n      .withArgs(address).returns(proxyStub)\n  })\n  aragonOSCoreStub.getAragonOsInternalAppInfo.withArgs(appIds[kernelAddress]).returns({\n    abi: 'abi for kernel',\n    isAragonOsInternalApp: true\n  })\n  // Mock ens resolution to just return the appId\n  ensStub.resolve = sinon.stub().returnsArg(0)\n\n  const instance = createAragon()\n  instance.apm = {\n    fetchLatestRepoContentForContract: (appId) => Promise.resolve({\n      abi: `abi for ${appId}`\n    })\n  }\n  instance.permissions = of(permissionsObj)\n  instance.kernelProxy = {\n    address: kernelAddress,\n    call: sinon.stub().withArgs('KERNEL_APP_ID').resolves('kernel'),\n    events: sinon.stub()\n      .withArgs('SetApp', {})\n      .returns(setAppEventStub)\n  }\n\n  // act\n  await instance.initApps()\n\n  // assert\n  // Check initial value of apps\n  await new Promise(resolve => {\n    instance.apps.pipe(first()).subscribe(value => {\n      t.deepEqual(value, [\n        {\n          abi: 'abi for kernel',\n          appId: 'kernel',\n          codeAddress: '0xkernel',\n          isAragonOsInternalApp: true,\n          proxyAddress: '0x123'\n        }, {\n          abi: 'abi for counterApp',\n          appId: 'counterApp',\n          codeAddress: '0xcounterApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x456'\n        }, {\n          abi: 'abi for votingApp',\n          appId: 'votingApp',\n          codeAddress: '0xvotingApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x789'\n        }\n      ])\n      resolve()\n    })\n  })\n\n  // act\n  setAppEventStub.next({\n    returnValues: {\n      appId: 'counterApp',\n      namespace: APP_NAMESPACE_HASH\n    }\n  })\n  await new Promise(resolve => setTimeout(resolve, 100)) // let the emission propagate\n\n  // assert\n  // Check app has been updated\n  await new Promise(resolve => {\n    instance.apps.pipe(first()).subscribe(value => {\n      t.deepEqual(value, [\n        {\n          abi: 'abi for kernel',\n          appId: 'kernel',\n          codeAddress: '0xkernel',\n          isAragonOsInternalApp: true,\n          proxyAddress: '0x123'\n        }, {\n          abi: 'abi for counterApp',\n          appId: 'counterApp',\n          codeAddress: '0xcounterApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x456',\n          updated: true\n        }, {\n          abi: 'abi for votingApp',\n          appId: 'votingApp',\n          codeAddress: '0xvotingApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x789'\n        }\n      ])\n      resolve()\n    })\n  })\n\n  // act\n  setAppEventStub.next({\n    returnValues: {\n      appId: 'votingApp',\n      namespace: APP_NAMESPACE_HASH\n    }\n  })\n  await new Promise(resolve => setTimeout(resolve, 100)) // let the emission propagate\n\n  // assert\n  // Check correct app has been updated\n  await new Promise(resolve => {\n    instance.apps.pipe(first()).subscribe(value => {\n      t.deepEqual(value, [\n        {\n          abi: 'abi for kernel',\n          appId: 'kernel',\n          codeAddress: '0xkernel',\n          isAragonOsInternalApp: true,\n          proxyAddress: '0x123'\n        }, {\n          abi: 'abi for counterApp',\n          appId: 'counterApp',\n          codeAddress: '0xcounterApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x456'\n        }, {\n          abi: 'abi for votingApp',\n          appId: 'votingApp',\n          codeAddress: '0xvotingApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x789',\n          updated: true\n        }\n      ])\n      resolve()\n    })\n  })\n\n  // act\n  setAppEventStub.next({\n    returnValues: {\n      appId: 'counterApp',\n      namespace: CORE_NAMESPACE_HASH\n    }\n  })\n  await new Promise(resolve => setTimeout(resolve, 100)) // let the emission propagate\n\n  // assert\n  // Check that we filtered the last emission as it wasn't the correct namespace\n  await new Promise(resolve => {\n    instance.apps.pipe(first()).subscribe(value => {\n      t.deepEqual(value, [\n        {\n          abi: 'abi for kernel',\n          appId: 'kernel',\n          codeAddress: '0xkernel',\n          isAragonOsInternalApp: true,\n          proxyAddress: '0x123'\n        }, {\n          abi: 'abi for counterApp',\n          appId: 'counterApp',\n          codeAddress: '0xcounterApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x456'\n        }, {\n          abi: 'abi for votingApp',\n          appId: 'votingApp',\n          codeAddress: '0xvotingApp',\n          isForwarder: false,\n          kernelAddress: '0x123',\n          proxyAddress: '0x789',\n          updated: true\n        }\n      ])\n      resolve()\n    })\n  })\n})\n\ntest('should init the app identifiers correctly', async (t) => {\n  t.plan(1)\n  // arrange\n  const { createAragon } = t.context\n  const instance = createAragon()\n  // act\n  await instance.initAppIdentifiers()\n  // assert\n  instance.appIdentifiers.subscribe(value => {\n    t.deepEqual(value, {})\n  })\n})\n\ntest('should emit reduced app identifiers correctly', async (t) => {\n  t.plan(3)\n  // arrange\n  const { createAragon } = t.context\n  const instance = createAragon()\n  await instance.initAppIdentifiers()\n\n  // act\n  instance.setAppIdentifier('0x123', 'ANT')\n  // assert\n  instance.appIdentifiers.pipe(first()).subscribe(value => {\n    t.deepEqual(value, {\n      '0x123': 'ANT'\n    })\n  })\n\n  // act\n  instance.setAppIdentifier('0x456', 'BNT')\n  // assert\n  instance.appIdentifiers.pipe(first()).subscribe(value => {\n    t.deepEqual(value, {\n      '0x123': 'ANT',\n      '0x456': 'BNT'\n    })\n  })\n\n  // act\n  instance.setAppIdentifier('0x123', 'CNT')\n  // assert\n  instance.appIdentifiers.pipe(first()).subscribe(value => {\n    t.deepEqual(value, {\n      '0x123': 'CNT',\n      '0x456': 'BNT'\n    })\n  })\n})\n\ntest('should init the identity providers correctly', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(3)\n  // arrange\n  const instance = createAragon()\n\n  // act\n  await instance.initIdentityProviders()\n  // assert\n  t.truthy(instance.identityProviderRegistrar)\n  t.true(instance.identityProviderRegistrar instanceof Map)\n  t.is(instance.identityProviderRegistrar.size, 1, 'Should have only one provider')\n})\n\ntest('should emit an intent when requesting address identity modification', async (t) => {\n  const { createAragon } = t.context\n  const expectedAddress = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n\n  // act\n  await instance.initIdentityProviders()\n\n  instance.identityIntents.subscribe(intent => {\n    t.is(intent.address, expectedAddress)\n    t.is(intent.providerName, 'local')\n  })\n\n  instance.requestAddressIdentityModification(expectedAddress)\n})\n\ntest('should be able to resolve intent when requesting address identity modification', async (t) => {\n  const { createAragon } = t.context\n  const expectedAddress = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n\n  // act\n  await instance.initIdentityProviders()\n\n  let counter = 0\n  instance.identityIntents.subscribe(intent => {\n    intent.resolve(counter++)\n  })\n\n  return Promise.all([\n    instance.requestAddressIdentityModification(expectedAddress).then(val => t.is(val, 0)),\n    instance.requestAddressIdentityModification(expectedAddress).then(val => t.is(val, 1))\n  ])\n})\n\ntest('should be able to reject intent when requesting address identity modification', async (t) => {\n  const { createAragon } = t.context\n  const expectedAddress = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n\n  // act\n  await instance.initIdentityProviders()\n\n  let counter = 0\n  instance.identityIntents.subscribe(intent => {\n    if (counter === 0) {\n      intent.reject()\n    } else {\n      intent.reject(new Error('custom error'))\n    }\n    counter++\n  })\n\n  return Promise.all([\n    t.throwsAsync(\n      instance.requestAddressIdentityModification(expectedAddress),\n      {\n        instanceOf: Error,\n        message: 'The identity modification was not completed'\n      }\n    ),\n    t.throwsAsync(\n      instance.requestAddressIdentityModification(expectedAddress),\n      {\n        instanceOf: Error,\n        message: 'custom error'\n      }\n    )\n  ])\n})\n\ntest('should init the forwarders correctly', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.apps = of([\n    {\n      appId: 'counterApp',\n      isForwarder: true\n    }, {\n      appId: 'votingApp',\n      isForwarder: false\n    }\n  ])\n  // act\n  await instance.initForwarders()\n  // assert\n  instance.forwarders.subscribe(value => {\n    t.deepEqual(value, [\n      {\n        appId: 'counterApp',\n        isForwarder: true\n      }\n    ])\n  })\n})\n\ntest('should emit an intent when requesting message signing', async (t) => {\n  const { createAragon } = t.context\n  const messageToSign = 'test message'\n  const requestingApp = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.signatures = new Subject()\n\n  // act\n  instance.signatures.subscribe(intent => {\n    t.is(intent.message, messageToSign)\n    t.is(intent.requestingApp, requestingApp)\n  })\n\n  instance.signMessage(messageToSign, requestingApp)\n})\n\ntest('should be able to resolve intent when requesting message signing', async (t) => {\n  const { createAragon } = t.context\n  const messageToSign = 'test message'\n  const requestingApp = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.signatures = new Subject()\n\n  // act\n  let counter = 0\n  instance.signatures.subscribe(intent => {\n    intent.resolve(counter++)\n  })\n\n  return Promise.all([\n    instance.signMessage(messageToSign, requestingApp).then(val => t.is(val, 0)),\n    instance.signMessage(messageToSign, requestingApp).then(val => t.is(val, 1))\n  ])\n})\n\ntest('should be able to reject intent when requesting message signing', async (t) => {\n  const { createAragon } = t.context\n  const messageToSign = 'test message'\n  const requestingApp = '0x123'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.signatures = new Subject()\n\n  // act\n  let counter = 0\n  instance.signatures.subscribe(intent => {\n    if (counter === 0) {\n      intent.reject()\n    } else {\n      intent.reject(new Error('custom error'))\n    }\n    counter++\n  })\n\n  return Promise.all([\n    t.throwsAsync(\n      instance.signMessage(messageToSign, requestingApp),\n      {\n        instanceOf: Error,\n        message: 'The message was not signed'\n      }\n    ),\n    t.throwsAsync(\n      instance.signMessage(messageToSign, requestingApp),\n      {\n        instanceOf: Error,\n        message: 'custom error'\n      }\n    )\n  ])\n})\n\ntest('should reject non-string message when requesting message signature', async (t) => {\n  const { createAragon } = t.context\n  const messageToSign = { key: 'this is not a string' }\n  const requestingApp = '0x123'\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n\n  // act\n  return t.throwsAsync(instance.signMessage(messageToSign, requestingApp),\n    {\n      instanceOf: Error,\n      message: 'Message to sign must be a string'\n    }\n  )\n})\n\ntest('should emit an intent when performing transaction path', async (t) => {\n  const { createAragon } = t.context\n  const initialAddress = '0x123'\n  const targetAddress = '0x456'\n\n  t.plan(3)\n  // arrange\n  const instance = createAragon()\n  instance.transactions = new Subject()\n\n  // act\n  instance.transactions.subscribe(intent => {\n    t.deepEqual(intent.transaction, { to: initialAddress })\n    t.true(Array.isArray(intent.path))\n    t.is(intent.path.length, 2)\n  })\n\n  instance.performTransactionPath([{ to: initialAddress }, { to: targetAddress }])\n})\n\ntest('should be able to resolve intent when performing transaction path', async (t) => {\n  const { createAragon } = t.context\n  const initialAddress = '0x123'\n  const targetAddress = '0x456'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.transactions = new Subject()\n\n  // act\n  let counter = 0\n  instance.transactions.subscribe(intent => {\n    intent.resolve(counter++)\n  })\n\n  return Promise.all([\n    instance.performTransactionPath([{ to: initialAddress }, { to: targetAddress }]).then(val => t.is(val, 0)),\n    instance.performTransactionPath([{ to: initialAddress }, { to: targetAddress }]).then(val => t.is(val, 1))\n  ])\n})\n\ntest('should be able to reject intent when perform transaction path', async (t) => {\n  const { createAragon } = t.context\n  const initialAddress = '0x123'\n  const targetAddress = '0x456'\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.transactions = new Subject()\n\n  // act\n  let counter = 0\n  instance.transactions.subscribe(intent => {\n    if (counter === 0) {\n      intent.reject()\n    } else {\n      intent.reject(new Error('custom error'))\n    }\n    counter++\n  })\n\n  return Promise.all([\n    t.throwsAsync(\n      instance.performTransactionPath([{ to: initialAddress }, { to: targetAddress }]),\n      {\n        instanceOf: Error,\n        message: 'The transaction was not signed'\n      }\n    ),\n    t.throwsAsync(\n      instance.performTransactionPath([{ to: initialAddress }, { to: targetAddress }]),\n      {\n        instanceOf: Error,\n        message: 'custom error'\n      }\n    )\n  ])\n})\n\ntest('should throw if no functions are found, when calculating the transaction path', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.permissions = of({\n    counter: {\n      add: {\n        allowedEntities: ['0x1', '0x2']\n      },\n      subtract: {\n        allowedEntities: ['0x1'],\n        manager: 'im manager'\n      }\n    }\n  })\n  instance.forwarders = of([\n    {\n      appId: 'forwarderA',\n      proxyAddress: '0x999'\n    }\n  ])\n  instance.apps = of([\n    {\n      appId: 'counterApp',\n      kernelAddress: '0x123',\n      functions: [{\n        sig: 'signature',\n        roles: []\n      }],\n      proxyAddress: '0x456'\n    }, {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      // functions: [{\n      //   sig: 'signature',\n      //   roles: []\n      // }],\n      proxyAddress: '0x789'\n    }\n  ])\n  // act\n  return instance.calculateTransactionPath(null, '0x789', 'signature')\n    .catch(err => {\n      // assert\n      t.is(err.message, 'No method named signature on 0x789')\n      /*\n       * Note: This test also \"asserts\" that the permissions object, the app object and the\n       * forwarders array does not throw any errors when they are being extracted from their observables.\n       */\n    })\n})\n\ntest('should use normal transaction pathing when finding external transaction path for installed app', async (t) => {\n  const { createAragon } = t.context\n  const targetAddress = '0x123'\n  const targetMethodAbiFragment = [{ name: 'foo' }]\n  const targetParams = [8]\n  const mockPath = [{ to: '0x123', data: '0x456' }]\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.accounts = of('0x00')\n  instance.aclProxy = of({\n    address: '0x456'\n  })\n  instance.apps = of([\n    {\n      appId: 'counterApp',\n      kernelAddress: '0x789',\n      abi: 'abi for counterApp',\n      proxyAddress: targetAddress\n    }\n  ])\n  instance.getTransactionPath = sinon.stub().returns(mockPath)\n  // act\n  const externalPath = await instance.getExternalTransactionPath(targetAddress, targetMethodAbiFragment, targetParams)\n  // assert\n  t.deepEqual(externalPath, mockPath)\n  t.true(instance.getTransactionPath.calledOnceWith(targetAddress, targetMethodAbiFragment.name, targetParams))\n})\n\ntest('should be able to find external transaction path for non-installed app', async (t) => {\n  const { createAragon, utilsStub } = t.context\n  const targetAddress = '0x123'\n  const targetMethodAbiFragment = [{ name: 'foo' }]\n  const targetParams = [8]\n  const mockTransaction = { to: targetAddress, data: '0x123' }\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.accounts = of('0x00')\n  instance.aclProxy = of({\n    address: '0x456'\n  })\n  instance.apps = of([\n    {\n      appId: 'counterApp',\n      kernelAddress: '0x789',\n      abi: 'abi for counterApp',\n      proxyAddress: '0x456'\n    }\n  ])\n  instance.describeTransactionPath = sinon.stub().returnsArg(0)\n  utilsStub.transactions.createDirectTransaction = sinon.stub().returns(mockTransaction)\n  // act\n  const externalPath = await instance.getExternalTransactionPath(targetAddress, targetMethodAbiFragment, targetParams)\n  // assert\n  t.deepEqual(externalPath, [mockTransaction])\n})\n\ntest('should be able to find external transaction path for ACL', async (t) => {\n  const { createAragon, utilsStub } = t.context\n  const targetAddress = '0x123'\n  const targetMethodAbiFragment = [{ name: 'foo' }]\n  const targetParams = [8]\n  const mockPath = [{ to: '0x123', data: '0x123' }]\n\n  t.plan(2)\n  // arrange\n  const instance = createAragon()\n  instance.accounts = of('0x00')\n  instance.aclProxy = of({\n    address: targetAddress\n  })\n  instance.apps = of([\n    {\n      appId: 'ACL',\n      kernelAddress: '0x789',\n      abi: 'abi for ACL',\n      proxyAddress: '0x456'\n    }\n  ])\n  utilsStub.addressesEqual = sinon.stub().returns(true)\n  instance.getACLTransactionPath = sinon.stub().returns(mockPath)\n  // act\n  const externalPath = await instance.getExternalTransactionPath(targetAddress, targetMethodAbiFragment, targetParams)\n  // assert\n  t.deepEqual(externalPath, mockPath)\n  t.true(instance.getACLTransactionPath.calledOnceWith(targetMethodAbiFragment.name, targetParams))\n})\n\ntest('should run the app and reply to a request', async (t) => {\n  const { createAragon, messengerConstructorStub, utilsStub } = t.context\n\n  // Note: This is not a \"real\" unit test because the rpc handlers are not mocked\n  t.plan(4)\n  // arrange\n  const requestsStub = of({\n    id: 'uuid1',\n    method: 'cache',\n    params: ['get', 'settings']\n  })\n  const messengerStub = {\n    sendResponse: sinon.stub(),\n    requests: () => requestsStub\n  }\n  messengerConstructorStub.withArgs('someMessageProvider').returns(messengerStub)\n\n  const instance = createAragon()\n  instance.cache.get = sinon.stub()\n    .withArgs('0x789.settings')\n    .returns(of('user settings for the voting app'))\n  instance.apps = of([\n    {\n      appId: 'some other app with a different proxy',\n      proxyAddress: '0x456'\n    }, {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      abi: 'abi for votingApp',\n      proxyAddress: '0x789'\n    }\n  ])\n  utilsStub.makeProxyFromAppABI = (proxyAddress) => ({\n    address: proxyAddress,\n    updateInitializationBlock: () => {}\n  })\n  instance.kernelProxy = { initializationBlock: 0 }\n  // act\n  const connect = await instance.runApp('0x789')\n  const result = connect('someMessageProvider')\n  // assert\n  t.true(result.shutdown !== undefined)\n  t.true(result.shutdownAndClearCache !== undefined)\n  /**\n   * What we're testing here is that the request for getting the cache (messenger.requests())\n   * is handled by the appropriate requestHandler.\n   */\n  t.is(messengerStub.sendResponse.getCall(0).args[0], 'uuid1')\n  t.is(messengerStub.sendResponse.getCall(0).args[1], 'user settings for the voting app')\n})\n\ntest('should run the app and be able to shutdown', async (t) => {\n  const { createAragon, messengerConstructorStub, utilsStub } = t.context\n\n  // Note: This is not a \"real\" unit test because the rpc handlers are not mocked\n  t.plan(1)\n  // arrange\n  const requestsStub = new Subject()\n  const messengerStub = {\n    sendResponse: sinon.stub(),\n    requests: () => requestsStub\n  }\n  messengerConstructorStub.withArgs('someMessageProvider').returns(messengerStub)\n\n  const instance = createAragon()\n  instance.apps = of([\n    {\n      appId: 'some other app with a different proxy',\n      proxyAddress: '0x456'\n    }, {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      abi: 'abi for votingApp',\n      proxyAddress: '0x789'\n    }\n  ])\n  // Mimic never-ending stream\n  instance.accounts = new ReplaySubject(1)\n  instance.accounts.next('0x00')\n\n  utilsStub.makeProxyFromAppABI = (proxyAddress) => ({\n    address: proxyAddress,\n    updateInitializationBlock: () => {}\n  })\n  instance.kernelProxy = { initializationBlock: 0 }\n\n  // act\n  const connect = await instance.runApp('0x789')\n  const result = connect('someMessageProvider')\n\n  // send one message\n  requestsStub.next({\n    id: 'uuid1',\n    method: 'accounts'\n  })\n\n  // shutdown\n  result.shutdown()\n\n  // should not handle message after shutdown\n  requestsStub.next({\n    id: 'uuid2',\n    method: 'accounts'\n  })\n\n  // assert\n  // test that we've only handled messages before the handlers were shutdown\n  t.is(messengerStub.sendResponse.callCount, 1)\n})\n\ntest('should run the app and be able to shutdown and clear cache', async (t) => {\n  const { createAragon, messengerConstructorStub, utilsStub } = t.context\n  const runningProxyAddress = '0x789'\n\n  // Note: This is not a \"real\" unit test because the rpc handlers are not mocked\n  t.plan(2)\n  // arrange\n  const requestsStub = new Subject()\n  const messengerStub = {\n    sendResponse: sinon.stub(),\n    requests: () => requestsStub\n  }\n  messengerConstructorStub.withArgs('someMessageProvider').returns(messengerStub)\n\n  const instance = createAragon()\n  instance.apps = of([\n    {\n      appId: 'some other app with a different proxy',\n      proxyAddress: '0x456'\n    }, {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      abi: 'abi for votingApp',\n      proxyAddress: runningProxyAddress\n    }\n  ])\n  // Mimic never-ending stream\n  instance.accounts = new ReplaySubject(1)\n  instance.accounts.next('0x00')\n\n  utilsStub.makeProxyFromAppABI = (proxyAddress) => ({\n    address: proxyAddress,\n    updateInitializationBlock: () => {}\n  })\n  instance.kernelProxy = { initializationBlock: 0 }\n\n  // set up cache\n  await instance.cache.init()\n  await instance.cache.set(`${runningProxyAddress}.key1`, 'value1')\n  await instance.cache.set(`${runningProxyAddress}.key2`, 'value2')\n  await instance.cache.set('alternative.key', 'alternative value')\n\n  // act\n  const connect = await instance.runApp(runningProxyAddress)\n  const result = connect('someMessageProvider')\n\n  // send one message\n  requestsStub.next({\n    id: 'uuid1',\n    method: 'accounts'\n  })\n\n  // shutdown and clear cache\n  await result.shutdownAndClearCache()\n\n  // should not handle message after shutdown\n  requestsStub.next({\n    id: 'uuid2',\n    method: 'accounts'\n  })\n\n  // assert\n  // test that we've only handled messages before the handlers were shutdown\n  t.is(messengerStub.sendResponse.callCount, 1)\n  // test that we've cleared the cache for the running app\n  t.true(Object.keys(await instance.cache.getAll()).every(key => !key.startsWith(runningProxyAddress)))\n})\n\ntest('should get the app from a proxy address', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.apps = of([\n    {\n      appId: 'some other app with a different proxy',\n      proxyAddress: '0x456'\n    }, {\n      appId: 'votingApp',\n      kernelAddress: '0x123',\n      abi: 'abi for votingApp',\n      proxyAddress: '0x789'\n    }\n  ])\n  // act\n  const result = await instance.getApp('0x789')\n  // assert\n  t.deepEqual(result, {\n    appId: 'votingApp',\n    kernelAddress: '0x123',\n    abi: 'abi for votingApp',\n    proxyAddress: '0x789'\n  })\n})\n\ntest('should get the permission manager', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  instance.permissions = of({\n    counter: {\n      add: {\n        allowedEntities: ['0x1', '0x2']\n      },\n      subtract: {\n        allowedEntities: ['0x1'],\n        manager: 'im manager'\n      }\n    }\n  })\n  // act\n  const result = await instance.getPermissionManager('counter', 'subtract')\n  // assert\n  t.is(result, 'im manager')\n})\n\ntest('should be able to decode an evm call script with a single transaction', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  const script = encodeCallScript([{\n    to: '0xcafe1a77e84698c83ca8931f54a755176ef75f2c',\n    data: '0xcafe'\n  }])\n  // act\n  const decodedScript = instance.decodeTransactionPath(script)\n  // assert\n  t.deepEqual(decodedScript, [\n    {\n      data: '0xcafe',\n      to: '0xcafe1a77e84698c83ca8931f54a755176ef75f2c'\n    }\n  ])\n})\n\ntest('should be able to decode an evm call script with multiple transactions', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  const script = encodeCallScript([{\n    to: '0xcafe1a77e84698c83ca8931f54a755176ef75f2c',\n    data: '0xcafe'\n  }, {\n    to: '0xbeefbeef03c7e5a1c29e0aa675f8e16aee0a5fad',\n    data: '0xbeef'\n  }, {\n    to: '0xbaaabaaa03c7e5a1c29e0aa675f8e16aee0a5fad',\n    data: '0x'\n  }])\n  // act\n  const decodedScript = instance.decodeTransactionPath(script)\n  // assert\n  t.deepEqual(decodedScript, [\n    {\n      to: '0xcafe1a77e84698c83ca8931f54a755176ef75f2c',\n      data: '0xcafe'\n    }, {\n      to: '0xbeefbeef03c7e5a1c29e0aa675f8e16aee0a5fad',\n      data: '0xbeef'\n    }, {\n      to: '0xbaaabaaa03c7e5a1c29e0aa675f8e16aee0a5fad',\n      data: '0x'\n    }\n  ])\n})\n\ntest('should be able to decode an evm call script with multiple nested transactions', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  /* eslint-disable no-multi-spaces */\n  const script = encodeCallScript([{\n    to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n    data: '0x' +\n          'd948d468' +                                                            // forward signature\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n          '0000000000000000000000000000000000000000000000000000000000000060' +    // 96 data bytes length\n          '00000001' +                                                            // spec id\n          '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n          '00000044' +                                                            // 68 data bytes length\n          '40c10f19' +                                                            // mint\n          '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +    // token holder\n          '0000000000000000000000000000000000000000000000003782dace9d900000'      // 4e18\n  }, {\n    to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n    data: '0x' +\n          'd948d468' +                                                            // forward signature\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n          '00000000000000000000000000000000000000000000000000000000000000c0' +    // 192 data bytes length\n          '00000001' +                                                            // spec id\n          '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n          '000000a4' +                                                            // 164 data bytes length\n          'bfe07da6' +                                                            // deposit\n          '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +    // token holder\n          '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +    // 1e18\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // 1 word\n          '0000000000000000000000000000000000000000000000000000000000000004' +    // 4 bytes\n          '4141414100000000000000000000000000000000000000000000000000000000'      // \"AAAA\" encoded\n  }])\n  /* eslint-enable no-multi-spaces */\n  // act\n  const decodedScript = instance.decodeTransactionPath(script)\n  // assert\n  t.deepEqual(decodedScript, [\n    {\n      to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n      data: '0x' +\n            'd948d468' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '0000000000000000000000000000000000000000000000000000000000000060' +\n            '00000001' +\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +\n            '00000044' +\n            '40c10f19' +\n            '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n            '0000000000000000000000000000000000000000000000003782dace9d900000',\n      children: [{\n        data: '0x' +\n            '40c10f19' +\n            '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n            '0000000000000000000000000000000000000000000000003782dace9d900000',\n        to: '0x14a3208711873b6aab2005f6cca0f91658e287ef'\n      }]\n    }, {\n      to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n      data: '0x' +\n            'd948d468' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '00000000000000000000000000000000000000000000000000000000000000c0' +\n            '00000001' +\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +\n            '000000a4' +\n            'bfe07da6' +\n            '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +\n            '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '0000000000000000000000000000000000000000000000000000000000000004' +\n            '4141414100000000000000000000000000000000000000000000000000000000',\n      children: [{\n        data: '0x' +\n              'bfe07da6' +\n              '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +\n              '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +\n              '0000000000000000000000000000000000000000000000000000000000000020' +\n              '0000000000000000000000000000000000000000000000000000000000000004' +\n              '4141414100000000000000000000000000000000000000000000000000000000',\n        to: '0x14a3208711873b6aab2005f6cca0f91658e287ef'\n      }]\n    }\n  ])\n})\n\ntest('should be able to decode an evm call script with a complex nested transaction', async (t) => {\n  const { createAragon } = t.context\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  /* eslint-disable no-multi-spaces */\n  const nestedScript =\n    encodeCallScript([{\n      to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n      data: '0x' +\n            'd948d468' +                                                            // forward signature\n            '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n            '0000000000000000000000000000000000000000000000000000000000000060' +    // 96 data bytes length\n            '00000001' +                                                            // spec id\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n            '00000044' +                                                            // 68 data bytes length\n            '40c10f19' +                                                            // mint\n            '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +    // token holder\n            '0000000000000000000000000000000000000000000000003782dace9d900000'      // 4e18\n    }, {\n      to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n      data: '0x' +\n            'd948d468' +                                                            // forward signature\n            '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n            '00000000000000000000000000000000000000000000000000000000000000c0' +    // 192 data bytes length\n            '00000001' +                                                            // spec id\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n            '000000a4' +                                                            // 164 data bytes length\n            'bfe07da6' +                                                            // deposit\n            '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +    // token holder\n            '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +    // 1e18\n            '0000000000000000000000000000000000000000000000000000000000000020' +    // 1 word\n            '0000000000000000000000000000000000000000000000000000000000000004' +    // 4 bytes\n            '4141414100000000000000000000000000000000000000000000000000000000'      // \"AAAA\" encoded\n    }]).substring(2)                                                                   // cut off '0x' prefix\n  // Divide by 2 for hex, convert number into hex string, and pad for uint256\n  const nestedScriptDataLength = `${(nestedScript.length / 2).toString(16)}`.padStart(64, 0)\n  const script = encodeCallScript([{\n    to: '0x62451b8705e6691b92afaa7766c0722c93a0e204',\n    data: '0x' +\n          'd948d468' +                                                            // forward signature\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n          nestedScriptDataLength +                                                // previous script data bytes length\n          nestedScript                                                            // previous script data\n  }])\n  /* eslint-enable no-multi-spaces */\n  // act\n  const decodedScript = instance.decodeTransactionPath(script)\n  // assert\n  t.deepEqual(decodedScript, [\n    {\n      to: '0x62451b8705e6691b92afaa7766c0722c93a0e204',\n      data: '0x' +\n            'd948d468' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            nestedScriptDataLength +\n            nestedScript,\n      children: [\n        {\n          to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n          data: '0x' +\n                'd948d468' +\n                '0000000000000000000000000000000000000000000000000000000000000020' +\n                '0000000000000000000000000000000000000000000000000000000000000060' +\n                '00000001' +\n                '14a3208711873b6aab2005f6cca0f91658e287ef' +\n                '00000044' +\n                '40c10f19' +\n                '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n                '0000000000000000000000000000000000000000000000003782dace9d900000',\n          children: [{\n            data: '0x' +\n                '40c10f19' +\n                '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n                '0000000000000000000000000000000000000000000000003782dace9d900000',\n            to: '0x14a3208711873b6aab2005f6cca0f91658e287ef'\n          }]\n        }, {\n          to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n          data: '0x' +\n                'd948d468' +\n                '0000000000000000000000000000000000000000000000000000000000000020' +\n                '00000000000000000000000000000000000000000000000000000000000000c0' +\n                '00000001' +\n                '14a3208711873b6aab2005f6cca0f91658e287ef' +\n                '000000a4' +\n                'bfe07da6' +\n                '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +\n                '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +\n                '0000000000000000000000000000000000000000000000000000000000000020' +\n                '0000000000000000000000000000000000000000000000000000000000000004' +\n                '4141414100000000000000000000000000000000000000000000000000000000',\n          children: [{\n            data: '0x' +\n                  'bfe07da6' +\n                  '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +\n                  '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +\n                  '0000000000000000000000000000000000000000000000000000000000000020' +\n                  '0000000000000000000000000000000000000000000000000000000000000004' +\n                  '4141414100000000000000000000000000000000000000000000000000000000',\n            to: '0x14a3208711873b6aab2005f6cca0f91658e287ef'\n          }]\n        }\n      ]\n    }\n  ])\n})\n\ntest('should not decode non-call scripts', async (t) => {\n  const { createAragon } = t.context\n  const badSpecId = '0x00000002'\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  const script = `${badSpecId}${'123'.padStart(64, 0)}`\n  // assert\n  t.throws(\n    () => instance.decodeTransactionPath(script),\n    {\n      instanceOf: Error,\n      message: `Script could not be decoded: ${script}`\n    }\n  )\n})\n\ntest('should be only able to decode call scripts when there are multiple nested transactions', async (t) => {\n  const { createAragon } = t.context\n  const badSpecId = '0x00000002'\n\n  t.plan(1)\n  // arrange\n  const instance = createAragon()\n  /* eslint-disable no-multi-spaces */\n  const script = encodeCallScript([{\n    to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n    data: '0x' +\n          'd948d468' +                                                            // forward signature\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n          '0000000000000000000000000000000000000000000000000000000000000060' +    // 96 data bytes length\n          '00000001' +                                                            // spec id\n          '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n          '00000044' +                                                            // 68 data bytes length\n          '40c10f19' +                                                            // mint\n          '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +    // token holder\n          '0000000000000000000000000000000000000000000000003782dace9d900000'      // 4e18\n  }, {\n    to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n    data: '0x' +\n          'd948d468' +                                                            // forward signature\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // offset\n          '00000000000000000000000000000000000000000000000000000000000000c0' +    // 192 data bytes length\n          badSpecId.substring(2) +                                                // **BAD SPEC ID**\n          '14a3208711873b6aab2005f6cca0f91658e287ef' +                            // forward target\n          '000000a4' +                                                            // 164 data bytes length\n          'bfe07da6' +                                                            // deposit\n          '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +    // token holder\n          '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +    // 1e18\n          '0000000000000000000000000000000000000000000000000000000000000020' +    // 1 word\n          '0000000000000000000000000000000000000000000000000000000000000004' +    // 4 bytes\n          '4141414100000000000000000000000000000000000000000000000000000000'      // \"AAAA\" encoded\n  }])\n  /* eslint-enable no-multi-spaces */\n  // act\n  const decodedScript = instance.decodeTransactionPath(script)\n  // assert\n  t.deepEqual(decodedScript, [\n    {\n      to: '0xbfd1f54dc1c3b50ddf2f1d5fe2f8a6b9c29bb598',\n      data: '0x' +\n            'd948d468' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '0000000000000000000000000000000000000000000000000000000000000060' +\n            '00000001' +\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +\n            '00000044' +\n            '40c10f19' +\n            '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n            '0000000000000000000000000000000000000000000000003782dace9d900000',\n      children: [{\n        data: '0x' +\n            '40c10f19' +\n            '000000000000000000000000b4124cEB3451635DAcedd11767f004d8a28c6eE7' +\n            '0000000000000000000000000000000000000000000000003782dace9d900000',\n        to: '0x14a3208711873b6aab2005f6cca0f91658e287ef'\n      }]\n    },\n    {\n      to: '0x634faa183ba1f5f968cb96656d24dff66021f5a2',\n      data: '0x' +\n            'd948d468' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '00000000000000000000000000000000000000000000000000000000000000c0' +\n            badSpecId.substring(2) +\n            '14a3208711873b6aab2005f6cca0f91658e287ef' +\n            '000000a4' +\n            'bfe07da6' +\n            '0000000000000000000000008401eb5ff34cc943f096a32ef3d5113febe8d4eb' +\n            '0000000000000000000000000000000000000000000000000de0b6b3a7640000' +\n            '0000000000000000000000000000000000000000000000000000000000000020' +\n            '0000000000000000000000000000000000000000000000000000000000000004' +\n            '4141414100000000000000000000000000000000000000000000000000000000'\n      // ignores the second target's children because it's not a call script forward\n    }\n  ])\n})\n"],"file":"index.test.js"}