{"version":3,"sources":["../../../src/rpc/handlers/describe-script.js"],"names":["request","proxy","wrapper","script","params","describedPath","describeTransactionPath","decodeTransactionPath","identifiers","appIdentifiers","pipe","toPromise","Promise","all","map","step","app","getApp","to","identifier","name"],"mappings":";;;;;;;;;;;AAAA;;;;;;AAEe,wBAAgBA,OAAhB,EAAyBC,KAAzB,EAAgCC,OAAhC,EAAyC;AACtD,QAAMC,MAAM,GAAGH,OAAO,CAACI,MAAR,CAAe,CAAf,CAAf;AAEA,QAAMC,aAAa,GAAG,MAAMH,OAAO,CAACI,uBAAR,CAC1BJ,OAAO,CAACK,qBAAR,CAA8BJ,MAA9B,CAD0B,CAA5B,CAHsD,CAOtD;AACA;AACA;;AACA,QAAMK,WAAW,GAAG,MAAMN,OAAO,CAACO,cAAR,CAAuBC,IAAvB,CAA4B,uBAA5B,EAAqCC,SAArC,EAA1B;AACA,SAAOC,OAAO,CAACC,GAAR,CACLR,aAAa,CAACS,GAAd,CAAkB,MAAOC,IAAP,IAAgB;AAChC,UAAMC,GAAG,GAAG,MAAMd,OAAO,CAACe,MAAR,CAAeF,IAAI,CAACG,EAApB,CAAlB;;AAEA,QAAIF,GAAJ,EAAS;AACP,6CACKD,IADL;AAEEI,QAAAA,UAAU,EAAEX,WAAW,CAACO,IAAI,CAACG,EAAN,CAFzB;AAGEE,QAAAA,IAAI,EAAEJ,GAAG,CAACI;AAHZ;AAKD;;AAED,WAAOL,IAAP;AACD,GAZD,CADK,CAAP;AAeD","sourcesContent":["import { first } from 'rxjs/operators'\n\nexport default async function (request, proxy, wrapper) {\n  const script = request.params[0]\n\n  const describedPath = await wrapper.describeTransactionPath(\n    wrapper.decodeTransactionPath(script)\n  )\n\n  // Add name and identifier decoration\n  // TODO: deprecate this now that the app has enough information to get this information itself\n  // through getApps()\n  const identifiers = await wrapper.appIdentifiers.pipe(first()).toPromise()\n  return Promise.all(\n    describedPath.map(async (step) => {\n      const app = await wrapper.getApp(step.to)\n\n      if (app) {\n        return {\n          ...step,\n          identifier: identifiers[step.to],\n          name: app.name\n        }\n      }\n\n      return step\n    })\n  )\n}\n"],"file":"describe-script.js"}