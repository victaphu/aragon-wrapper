{"version":3,"sources":["../../../src/core/aragonOS/kernel.test.js"],"names":["test","afterEach","always","sinon","restore","SET_APP_TX_DATA","INITIALIZE_TX_DATA","t","plan","setAppData","notSetAppData","decodedData","kernel","decodeKernelSetAppParameters","is","namespace","appId","appAddress","throws","instanceOf","Error","coreNamespaceHash","result","getKernelNamespace","emptyResult","hash","name","appCodeNamespace","isKernelAppCodeNamespace","true","false","kernelApp","proxyAddress","functions","sig","roles","notice","setAppIntent","to","data","initializeIntent","otherAppIntent","setAppResult","isKernelSetAppIntent","initializeResult","otherAppResult"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport { soliditySha3 } from 'web3-utils'\nimport * as kernel from './kernel'\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\n// Kernel.setApp(APP_BASES_NAMESPACE, namehash('voting.aragonpm.eth'), '0x7FB5C052A391953De579b0ed7dC87aD59a9A5473')\nconst SET_APP_TX_DATA = '0xae5b2540f1f3eb40f5bc1ad1344716ced8b8a0431d840b5783aea1fd01786bc26f35ac0f9fa3927f639745e587912d4b0fea7ef9013bf93fb907d29faeab57417ba6e1d40000000000000000000000007fb5c052a391953de579b0ed7dc87ad59a9a5473'\n// Kernel.initialize('0xd95677b5b3bc3c89c4c2c3ab702b0aa5d5cb28af', '0x0000000000000000000000000000000000000000')\nconst INITIALIZE_TX_DATA = '0x485cc955000000000000000000000000d95677b5b3bc3c89c4c2c3ab702b0aa5d5cb28af0000000000000000000000000000000000000000000000000000000000000000'\n\ntest('aragonOS/kernel: decodeKernelSetAppParameters', async (t) => {\n  t.plan(4)\n  // arrange\n  const setAppData = SET_APP_TX_DATA\n  const notSetAppData = INITIALIZE_TX_DATA\n  // act\n  const decodedData = kernel.decodeKernelSetAppParameters(setAppData)\n  // assert\n  t.is(decodedData.namespace, '0xf1f3eb40f5bc1ad1344716ced8b8a0431d840b5783aea1fd01786bc26f35ac0f')\n  t.is(decodedData.appId, '0x9fa3927f639745e587912d4b0fea7ef9013bf93fb907d29faeab57417ba6e1d4')\n  t.is(decodedData.appAddress, '0x7FB5C052A391953De579b0ed7dC87aD59a9A5473')\n\n  t.throws(\n    () => kernel.decodeKernelSetAppParameters(notSetAppData),\n    {\n      instanceOf: Error\n    }\n  )\n})\n\ntest('aragonOS/kernel: getKernelNamespace', async (t) => {\n  t.plan(3)\n  // arrange\n  // soliditySha3('core')\n  const coreNamespaceHash = '0xc681a85306374a5ab27f0bbc385296a54bcd314a1948b6cf61c4ea1bc44bb9f8'\n  // act\n  const result = kernel.getKernelNamespace(coreNamespaceHash)\n  const emptyResult = kernel.getKernelNamespace()\n  // assert\n  t.is(result.hash, coreNamespaceHash)\n  t.is(result.name, 'Core')\n  t.is(emptyResult, null)\n})\n\ntest('aragonOS/kernel: isKernelAppCodeNamespace', async (t) => {\n  t.plan(2)\n  // arrange\n  const appCodeNamespace = soliditySha3('base')\n  // act\n  const result = kernel.isKernelAppCodeNamespace(appCodeNamespace)\n  const emptyResult = kernel.isKernelAppCodeNamespace()\n  // assert\n  t.true(result)\n  t.false(emptyResult)\n})\n\ntest('aragonOS/kernel: isKernelSetAppIntent', async (t) => {\n  t.plan(3)\n\n  // arrange\n  const kernelApp = {\n    proxyAddress: '0x123',\n    functions: [\n      {\n        sig: 'initialize(address,address)',\n        roles: [],\n        notice: 'Initializes a kernel instance along with its ACL and sets `_permissionsCreator` as the entity that can create other permissions'\n      },\n      {\n        sig: 'setApp(bytes32,bytes32,address)',\n        roles: [\n          'APP_MANAGER_ROLE'\n        ],\n        notice: 'Set the resolving address of `_appId` in namespace `_namespace` to `_app`'\n      }\n    ]\n  }\n  const setAppIntent = {\n    to: '0x123',\n    data: SET_APP_TX_DATA\n  }\n  const initializeIntent = {\n    to: '0x123',\n    data: INITIALIZE_TX_DATA\n  }\n  const otherAppIntent = {\n    to: '0x456',\n    // vote(0, true)\n    data: '0xc9d27afe00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001'\n  }\n\n  // act\n  const setAppResult = kernel.isKernelSetAppIntent(kernelApp, setAppIntent)\n  const initializeResult = kernel.isKernelSetAppIntent(kernelApp, initializeIntent)\n  const otherAppResult = kernel.isKernelSetAppIntent(kernelApp, otherAppIntent)\n\n  // assert\n  t.true(setAppResult)\n  t.false(initializeResult)\n  t.false(otherAppResult)\n})\n"],"file":"kernel.test.js"}